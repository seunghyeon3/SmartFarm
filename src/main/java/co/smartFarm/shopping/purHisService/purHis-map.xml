<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.smartFarm.shopping.purHisService.PurHisMapper">
   <select id="purHisInsert" 
   	parameterType="co.smartFarm.shopping.purHisService.PurHisVO"
   	statementType="CALLABLE">
        <![CDATA[
            {call insert_pur_his(
               #{mem_email},
               #{kit_no},
               #{plant_sale_no},
               #{pur_his_recv},
               #{pur_his_tel},
               #{pur_his_addr},
               #{pur_his_sale_count},
               #{pur_his_price}
            )}
         ]]>
       
   </select>
   
   <select id="adminPurHisSelectList" 
   		parameterType="co.smartFarm.shopping.purHisService.PurHisVO"
   		resultType="co.smartFarm.shopping.purHisService.PurHisVO">
		SELECT
		    PUR_HIS_PUR_DAY,
		    PUR_COUNT                   AS PLANT_SALE_NO,
		    SUM(PLANT_SUM)
		    OVER(
		    ORDER BY PUR_HIS_PUR_DAY)   AS PLANT_SUM,
		    SUM(KIT_SUM)
		    OVER(
		    ORDER BY PUR_HIS_PUR_DAY)   AS KIT_SUM,
		    SUM(PUR_SUM)
		    OVER(
		    ORDER BY PUR_HIS_PUR_DAY)   AS PUR_SUM
		FROM
		      ( SELECT
		            NUM,
		            MIN(PUR_HIS_PUR_DAY)                                     AS PUR_HIS_PUR_DAY,
		            COUNT(PUR_HIS_PRICE)                                     AS PUR_COUNT,
		            SUM(DECODE(KIT_NO, 0, PUR_HIS_PRICE, 0))                 AS KIT_SUM,
		            SUM(DECODE(PLANT_SALE_NO, 0, PUR_HIS_PRICE, 0))          AS PLANT_SUM,
		            SUM(PUR_HIS_PRICE)                                       AS PUR_SUM
		        FROM( SELECT
		                    ROUND( ( PUR_HIS_PUR_DAY - TO_DATE (#{start_date}, 'YYYY-MM-DD')) / 7, 0) + 1      AS NUM
		                    , PUR_HIS_PRICE
		                    , KIT_NO
		                    , PLANT_SALE_NO          
		                    , PUR_HIS_PUR_DAY
		                FROM PUR_HIS
		                WHERE PUR_HIS_PUR_DAY BETWEEN TO_DATE(#{start_date}, 'YYYY-MM-DD') AND TO_DATE(#{end_date}, 'YYYY-MM-DD' )) 
		                GROUP BY NUM)
		   
		 
		    
   </select>
   
   <select id="purHisPriceSelect" resultType="co.smartFarm.shopping.purHisService.PurHisVO">
		SELECT DISTINCT SUM(PUR_HIS_PRICE)
		OVER(PARTITION BY MEM_EMAIL)
		AS PUR_HIS_PRICE,
		MEM_EMAIL
		FROM PUR_HIS
   </select>
   
</mapper>
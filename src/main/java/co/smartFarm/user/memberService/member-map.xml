<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.smartFarm.user.memberService.MemberMapper">
	<!-- 이메일 중복체크 -->
	<select id="emailCheck" parameterType="co.smartFarm.user.memberService.MemberVO"
		resultType="co.smartFarm.user.memberService.MemberVO">
		SELECT * FROM MEMBER
		WHERE MEM_EMAIL = #{mem_email}
	</select>

	 <!-- 로그인 -->
	<select id="loginCheck"
		parameterType="co.smartFarm.user.memberService.MemberVO"
		resultType="co.smartFarm.user.memberService.MemberVO">
		SELECT *
		FROM MEMBER
		WHERE MEM_EMAIL = #{mem_email}

	</select>
	
	<!-- 전체 회원 조회 -->
	<select id="memberSelectList"
		resultType="co.smartFarm.user.memberService.MemberVO">
		SELECT
		     RPAD(SUBSTR(MEM_EMAIL, 0, 3), LENGTH(MEM_EMAIL), '*') MEM_EMAIL
		    , RPAD(SUBSTR(MEM_NAME, 0, 1), LENGTH(MEM_NAME) + 1, '*') MEM_NAME
		    , CASE WHEN  MEM_ATHR = 'B1' THEN '일반회원' 
		           WHEN MEM_ATHR = 'B2' THEN '농부'
		           WHEN MEM_ATHR = 'B0' THEN '관리자'
		    END MEM_ATHR
		    , NVL(MEM_FM_REQ, ' ') MEM_FM_REQ
		    , CASE WHEN MEM_ATHR = 'B2' THEN '농부'
		        WHEN MEM_ATHR ='B1' AND MEM_FM_REQ = 'Reject' THEN '거절됨'
		        WHEN MEM_ATHR = 'B1' AND MEM_FM_REQ IS NOT NULL THEN '신청중'
		        ELSE ' '
		    END MEM_FM_RESULT
		FROM MEMBER
	</select>

	<!-- 회원가입 -->
	<insert id="memberInsert"
		parameterType="co.smartFarm.user.memberService.MemberVO">
		INSERT INTO MEMBER(MEM_EMAIL, MEM_PW, MEM_ADDR,
			MEM_DET_ADDR, MEM_NAME, MEM_ATHR, MEM_TEL)
		VALUES(#{mem_email},
			#{mem_pw}, #{mem_addr}, #{mem_det_addr}, #{mem_name}, 'B1',
			#{mem_tel})
	</insert>
	
	<!-- 비밀번호 수정 -->
	<update id="memberUpdatePw" parameterType="co.smartFarm.user.memberService.MemberVO">
		UPDATE MEMBER
		SET MEM_PW = #{mem_pw}
		WHERE MEM_EMAIL = #{mem_email}
	</update>
	
	<!-- 농부 승인-승인 -->
	<update id="memberAcceptAthr" parameterType="String">
		UPDATE MEMBER
		SET MEM_ATHR = 'B2'
		WHERE MEM_EMAIL = #{mem_email}
	</update>
	
	<!-- 농부 승인-거절 -->
	<update id="memberRejectAthr" parameterType="String">
		UPDATE MEMBER
		SET MEM_FM_REQ = 'Reject'
		WHERE MEM_EMAIL = #{mem_email}
	</update>

	<!-- 회원 조회 -->
	<select id="memberSelectKeyList" resultType="co.smartFarm.user.memberService.MemberVO">
		SELECT * FROM MEMBER
		<if test="key == ''"> WHERE 1 = 1</if>
		<if test="key == 'mem_email'">WHERE MEM_EMAIL LIKE '%' || #{val} || '%'</if>
		<if test="key == 'mem_name'">WHERE MEM_NAME LIKE '%' || #{val} || '%'</if>
	</select>
	
</mapper>